<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Visualizador Speckle 3D</title>
  <style>
    html, body {
      margin: 0; height: 100%; width: 100%; overflow: hidden;
    }
    #renderer {
      width: 100%; height: 100%;
    }
  </style>
</head>
<body>
  <div id="renderer"></div>
  <script>
    (async () => {
      try {
        await new Promise((resolve, reject) => {
          const s = document.createElement('script');
          s.src = 'https://cdn.jsdelivr.net/npm/@speckle/viewer@2.18.2/build/viewer.umd.js';
          s.onload = resolve;
          s.onerror = () => reject(new Error('Erro ao carregar o script Speckle'));
          document.head.appendChild(s);
        });
        console.log('Speckle carregado');
        const container = document.getElementById('renderer');
        const app = new window.Speckle.ViewerApp(container);
        await app.init();
        console.log('App iniciado');
        const loader = new window.Speckle.SpeckleLoader(app.getWorld());
        await loader.loadStream({
          streamId: '8f8ced29b4',
          objectId: 'f22627d137'
        });
        console.log('Modelo carregado');
        app.on('select', (event) => {
          const selectedId = event?.data?.[0];
          if (selectedId) {
            window.parent.postMessage({ type: 'objectClicked', id: selectedId }, '*');
          }
        });
      } catch(e) {
        console.error(e);
      }
    })();
  </script>
</body>
</html>

